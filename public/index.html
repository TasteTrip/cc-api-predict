<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TasteTrip</title>
  <style>
    body {
      display: flex;
      align-items: center;
      flex-direction: column;
    }

    header {
      position: sticky;
      top: 0;
      background-color: white;
      text-align: center;
      width: 100%;
      max-width: 50rem;
    }

    #content {
      max-width: 50rem;
    }

    .food-description {
      text-align: justify;
    }
  </style>
</head>

<body>
  <header>
    <h1>TasteTrip: Food Photo Analyzer</h1>
    <form id="uploadForm">
      <input type="file" id="image" name="image" accept="image/*" required>
      <button type="button" id="uploadButton">Analyze</button>
    </form>
    <hr>
  </header>
  <main id="content"></main>

  <script>
    const foodData = {
      "Bakso": "Bakso is a beloved Indonesian meatball soup that has captured the hearts of many food enthusiasts. The meatballs are typically made from a mixture of finely ground beef or chicken, combined with tapioca flour for a bouncy texture. These are served in a savory, aromatic broth often seasoned with garlic, shallots, and white pepper. The dish is usually accompanied by yellow noodles or vermicelli, tofu, and sometimes siomay (dumplings) or boiled eggs. Toppings like fried shallots, celery, and a dash of sambal (chili sauce) elevate the flavors, making it a comforting street food staple.",
      "Batagor": "Batagor, short for Bakso Tahu Goreng, is a popular street food originating from Bandung, Indonesia. This dish combines deep-fried fish cakes and tofu stuffed with seasoned fish paste, creating a crispy and savory delight. It is typically served with a rich peanut sauce thatâ€™s sweet and slightly spicy, often accompanied by sweet soy sauce and a squeeze of lime. Batagor is enjoyed as a snack or light meal, cherished for its crunchy texture and the perfect balance of flavors in the sauce.",
      "Bubur Ayam": "Bubur Ayam, or chicken congee, is a warm and hearty rice porridge dish that is a breakfast favorite in Indonesia. The rice is cooked until it becomes creamy and smooth, then topped with shredded chicken, crispy fried shallots, scallions, and cakwe (fried dough sticks). A drizzle of soy sauce and a dollop of sambal add depth to the dish, while boiled eggs or chicken gizzards can be included as optional toppings. Served hot, it provides a comforting start to the day, especially in cooler weather.",
      "Gado-gado": "Gado-gado is a traditional Indonesian salad that offers a vibrant mix of steamed vegetables, boiled eggs, fried tofu, and tempeh. These ingredients are generously coated in a thick, aromatic peanut sauce made with ground peanuts, tamarind, and palm sugar, creating a perfect harmony of sweet, savory, and tangy flavors. The dish is typically garnished with crackers, fried shallots, and sometimes lontong (rice cakes) to make it a filling meal. Gado-gado is celebrated not only for its taste but also for its versatility and nutritional balance.",
      "Gorengan": "Gorengan refers to a variety of deep-fried snacks that are ubiquitous in Indonesia, sold by street vendors and enjoyed by people from all walks of life. Popular items include fried bananas (pisang goreng), battered tofu, tempeh, sweet potatoes, and vegetable fritters (bakwan). These snacks are known for their crispy, golden exterior and are often eaten as a quick bite or paired with hot tea. Gorengan stalls are a staple in Indonesian neighborhoods, offering an affordable and satisfying treat at any time of the day.",
      "Martabak Manis": "Martabak Manis is a sweet, thick pancake that is a favorite dessert in Indonesia. Made from a batter of flour, sugar, eggs, and yeast, it is cooked on a griddle until fluffy and golden. The pancake is then filled with a variety of toppings, such as grated cheese, crushed peanuts, chocolate sprinkles, and condensed milk, before being folded in half and sliced into portions. This indulgent treat is a popular choice for sharing among friends and family during evening gatherings or as a post-dinner dessert.",
      "Mie Ayam": "Mie Ayam, or chicken noodles, is a classic Indonesian street food dish that combines egg noodles with a flavorful topping of diced or shredded chicken cooked in a soy-based sauce. The noodles are typically served with a side of chicken broth and garnished with greens like bok choy, scallions, and fried shallots. Additional condiments such as sambal, vinegar, and soy sauce allow diners to customize the taste to their liking. Mie Ayam is a satisfying and quick meal, enjoyed by people of all ages.",
      "Nasi Goreng": "Nasi Goreng, or Indonesian fried rice, is a versatile and flavorful dish that is often considered the national dish of Indonesia. Made with day-old rice stir-fried in a mixture of sweet soy sauce, garlic, shallots, and chili, it is a dish bursting with umami. It can be customized with various add-ins like shrimp, chicken, eggs, and vegetables. Topped with a fried egg and served alongside pickled cucumbers and prawn crackers, Nasi Goreng is perfect for any time of day and a must-try for visitors to Indonesia.",
      "Nasi Padang": "Nasi Padang is a culinary experience that showcases the rich and diverse flavors of Minang cuisine from West Sumatra. Steamed white rice is served with an assortment of side dishes, such as rendang (spicy beef stew), ayam pop (steamed chicken), sambal balado (chili paste), and boiled cassava leaves. The variety of textures and bold, spicy flavors make each bite unique. Served in Padang restaurants where the dishes are brought to the table in small plates, Nasi Padang is a feast that reflects Indonesia's rich culinary heritage.",
      "Nasi Uduk": "Nasi Uduk is a fragrant coconut rice dish that is a staple of Indonesian cuisine, particularly in Jakarta. The rice is cooked with coconut milk, pandan leaves, lemongrass, and spices, resulting in a rich and aromatic flavor. It is often served with fried chicken, tempeh, omelets, sambal, and a sprinkling of crispy fried shallots. Nasi Uduk is commonly enjoyed as a breakfast dish but is versatile enough to be a satisfying meal at any time of the day.",
      "Pempek": "Pempek is a savory fishcake delicacy from Palembang, South Sumatra, made from a mixture of ground fish and tapioca flour. It comes in various shapes and sizes, with kapal selam (submarine-shaped) being the most famous, filled with a boiled egg. Pempek is typically served with a dark, tangy, and slightly sweet vinegar-based sauce called cuko. The combination of the soft fishcake and the bold sauce makes Pempek a unique culinary experience that is deeply rooted in Palembang's culinary traditions.",
      "Rawon": "Rawon is a distinctive beef soup from East Java, known for its rich, dark broth made from kluwak nuts, which give it an earthy and nutty flavor. Tender beef chunks are simmered with a blend of spices, including garlic, shallots, and turmeric, creating a hearty and aromatic dish. Rawon is often served with steamed rice, boiled eggs, bean sprouts, and sambal on the side, making it a comforting and satisfying meal. It is cherished for its unique taste and cultural significance.",
      "Sate Ayam": "Sate Ayam, or chicken satay, is one of Indonesia's most iconic dishes, featuring skewered and grilled chicken pieces that are marinated in a mix of sweet soy sauce and spices. The skewers are grilled over charcoal, giving them a smoky and slightly charred flavor. Served with a creamy peanut sauce, a drizzle of sweet soy sauce, and sometimes accompanied by lontong (rice cakes) and pickled vegetables, Sate Ayam is a perfect blend of sweetness, savory, and spice, enjoyed by locals and tourists alike.",
      "Soto Ayam": "Soto Ayam is a traditional Indonesian chicken soup with a rich and flavorful turmeric-based broth. The soup is typically filled with shredded chicken, glass noodles, boiled eggs, and sometimes rice cakes (lontong). Garnished with fried shallots, scallions, and a squeeze of lime, it is often accompanied by sambal and crackers for added texture and flavor. Soto Ayam is a versatile dish, commonly enjoyed as a comforting breakfast or a hearty meal during the day.",
      "Tongseng": "Tongseng is a spicy and flavorful Indonesian curry-like dish made with tender chunks of goat meat or beef. Cooked in a rich coconut milk base, the dish is infused with bold spices like turmeric, ginger, and galangal, creating a complex and aromatic flavor. Tongseng is often cooked with cabbage, tomatoes, and sweet soy sauce, giving it a balance of sweetness and heat. Typically served with steamed rice, it is a dish that reflects the culinary richness of Central Java and is often enjoyed during festive occasions."
    };

    function compressImage(file, maxDimension) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();

        reader.onload = function (event) {
          const img = new Image();
          img.src = event.target.result;

          img.onload = function () {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            let { width, height } = img;

            if (width > height && width > maxDimension) {
              height = Math.round((height * maxDimension) / width);
              width = maxDimension;
            } else if (height > maxDimension) {
              width = Math.round((width * maxDimension) / height);
              height = maxDimension;
            }

            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);

            canvas.toBlob(
              (blob) => {
                resolve(blob);
              },
              'image/jpeg',
              0.8
            );
          };

          img.onerror = reject;
        };

        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    document.getElementById('uploadButton').addEventListener('click', async (event) => {
      event.preventDefault();

      const fileInput = document.getElementById('image');
      const contentDiv = document.getElementById('content');

      if (!fileInput.files.length) {
        alert('Please select an image file!');
        return;
      }

      const loading = document.createElement('p');
      loading.id = 'loading';
      loading.textContent = 'loading...';
      contentDiv.appendChild(loading);

      try {
        const file = fileInput.files[0];

        const compressedFile = await compressImage(file, 1200);

        const formData = new FormData();
        formData.append('image', compressedFile, file.name);

        const response = await fetch('http://35.222.70.188:3000/api/predict', {
          method: 'POST',
          body: formData,
        });

        if (!response.ok) {
          throw new Error(`Error: ${response.statusText}`);
        }

        const data = await response.json();

        const highestEntry = Object.entries(data.result).reduce((max, current) => {
          return current[1] > max[1] ? current : max;
        }, Object.entries(data.result)[0]);

        const foodName = document.createElement('h2');
        foodName.textContent = Object.keys(foodData)[highestEntry[0]];
        contentDiv.appendChild(foodName);

        const foodInfo = document.createElement('p');
        foodInfo.textContent = foodData[Object.keys(foodData)[highestEntry[0]]];
        foodInfo.classList.add('food-description');
        contentDiv.appendChild(foodInfo);

      } catch (error) {
        const responseDiv = document.createElement('p');
        responseDiv.textContent = `Failed to upload: ${error.message}`;
        contentDiv.appendChild(responseDiv);

      } finally {
        const finishLoading = document.getElementById('loading');
        finishLoading.remove();
      }
    });
  </script>
</body>

</html>